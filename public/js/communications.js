window.handleFileSelection=function(e){var t=document.getElementById("selected-files");if(t.innerHTML="",e.files.length>0)for(var n=0;n<e.files.length;n++){var o=e.files[n],a=(o.size/1024).toFixed(0)+" KB",s=document.createElement("div");s.className="flex items-center bg-gray-100 rounded-md p-1 text-xs",s.innerHTML='\n                <svg class="w-4 h-4 mr-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"></path>\n                </svg>\n                <span class="truncate max-w-[150px]">'.concat(o.name,'</span>\n                <span class="ml-1 text-gray-500">(').concat(a,")</span>\n            "),t.appendChild(s)}},window.scrollToBottom=function(){var e=document.querySelector(".message-list");e&&(e.scrollTop=e.scrollHeight)},window.markAsRead=function(e,t){t&&t.preventDefault();var n=t?t.target:null,o=n?n.closest("li"):null;fetch(e,{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){if(e.success&&o){o.classList.remove("bg-blue-50"),o.classList.add("bg-white"),n&&n.remove();var t=document.querySelector('a[href*="notifications"] span');if(t){var a=parseInt(t.textContent);a>1?t.textContent=a-1:t.remove()}}})).catch((function(e){console.error("Error marking notification as read:",e)}))},document.addEventListener("DOMContentLoaded",(function(){var e=document.querySelectorAll('input[name="recipient_type"]');if(e.length>0&&e.forEach((function(e){e.addEventListener("change",(function(){var e=document.getElementById("user-selection"),t=document.getElementById("segment-selection");"users"===this.value?(e.classList.remove("hidden"),t.classList.add("hidden")):(e.classList.add("hidden"),t.classList.remove("hidden"))}))})),void 0!==$.fn.select2&&document.getElementById("select-users")){$("#select-users").select2({placeholder:"Select users",allowClear:!0,ajax:{url:function(){var e=window.location.pathname.split("/")[2];return"/business/".concat(e,"/communications/search-users")},dataType:"json",delay:250,data:function(e){return{q:e.term,page:e.page}},processResults:function(e,t){return t.page=t.page||1,{results:e.results,pagination:{more:!1}}},cache:!0}});var t=new Option("All Users","all_users",!1,!1);$("#select-users").append(t)}var n=document.querySelectorAll(".user-conversation-link");if(n&&n.length>0&&n.forEach((function(e){e.addEventListener("click",(function(t){t.preventDefault();var n=e.dataset.conversationId;n&&window.threadManagement&&window.threadManagement.loadConversation(n)}))})),sessionStorage.getItem("notification_modal_open")){var o=document.getElementById("newNotificationModal");o&&o.classList.remove("hidden"),sessionStorage.removeItem("notification_modal_open")}}));