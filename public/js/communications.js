(()=>{function e(e){e.preventDefault();var t=this,n=new FormData(t),r=document.querySelector('meta[name="csrf-token"]').content;fetch(t.action,{method:"POST",body:n,headers:{"X-CSRF-TOKEN":r,"X-Requested-With":"XMLHttpRequest"}}).then((function(e){return e.json()})).then((function(e){e.success?window.location.href="".concat(t.action.replace("/thread",""),"?thread_id=").concat(e.thread_id):(console.error("Error creating thread"),alert("Error creating thread"))})).catch((function(e){console.error("Error:",e),alert("An error occurred while creating the thread")}))}function t(e){e.preventDefault();var t=this,n=new FormData(t),r=document.querySelector('meta[name="csrf-token"]').content,o=t.querySelector('button[type="submit"]');o.disabled=!0,fetch(t.action,{method:"POST",body:n,headers:{"X-CSRF-TOKEN":r,"X-Requested-With":"XMLHttpRequest"}}).then((function(e){return e.json()})).then((function(e){if(e.success){t.querySelector('textarea[name="message"]').value="";var n=t.querySelector('input[type="file"]');n&&(n.value="");var r=window.location.href;loadConversation(r)}else alert("Error sending message")})).catch((function(e){console.error("Error:",e),alert("An error occurred while sending the message")})).finally((function(){o.disabled=!1}))}window.threadManagement={showNewThreadModal:function(){document.getElementById("newThreadModal").style.display="block"},hideNewThreadModal:function(){document.getElementById("newThreadModal").style.display="none"}},window.loadConversation=function(n){var r=document.getElementById("message-container");r.innerHTML='\n        <div class="flex h-full w-full items-center justify-center">\n            <svg class="animate-spin h-10 w-10 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">\n                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>\n                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>\n            </svg>\n        </div>\n    ',document.querySelectorAll(".w-72 a").forEach((function(e){e.classList.remove("bg-indigo-50")})),event.currentTarget.classList.add("bg-indigo-50"),fetch(n,{headers:{"X-Requested-With":"XMLHttpRequest"}}).then((function(e){return e.text()})).then((function(o){r.innerHTML=o,function(){var n=document.getElementById("newThreadForm");n&&n.addEventListener("submit",e);var r=document.querySelector(".message-form");r&&r.addEventListener("submit",t);o=document.querySelector(".message-list"),o&&(o.scrollTop=o.scrollHeight);var o}(),window.history.pushState({},"",n)})).catch((function(e){console.error("Error loading conversation:",e),r.innerHTML='\n            <div class="flex h-full w-full items-center justify-center flex-col">\n                <svg class="w-16 h-16 text-red-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>\n                </svg>\n                <h2 class="text-xl text-gray-700">Error loading conversation</h2>\n                <p class="text-gray-500 mt-2">Please try again later</p>\n            </div>\n        '}))},window.handleFileSelection=function(e){var t=document.getElementById("selected-files");if(t.innerHTML="",e.files.length>0)for(var n=0;n<e.files.length;n++){var r=e.files[n],o=(r.size/1024).toFixed(0)+" KB",a=document.createElement("div");a.className="flex items-center bg-gray-100 rounded-md p-1 text-xs",a.innerHTML='\n                <svg class="w-4 h-4 mr-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"></path>\n                </svg>\n                <span class="truncate max-w-[150px]">'.concat(r.name,'</span>\n                <span class="ml-1 text-gray-500">(').concat(o,")</span>\n            "),t.appendChild(a)}},window.initializeNotificationSelect2=function(){"undefined"!=typeof $&&void 0!==$.fn.select2&&document.getElementById("select-users")&&$("#select-users").select2({placeholder:"Select users",allowClear:!0,dropdownParent:$("#newNotificationModal"),ajax:{url:"/search-users",dataType:"json",delay:250,data:function(e){return{q:e.term}},processResults:function(e){return{results:e.results}},cache:!0}})},window.initializeChatSelect2=function(){"undefined"!=typeof $&&void 0!==$.fn.select2&&document.getElementById("chat-user-select")&&$("#chat-user-select").select2({placeholder:"Select a user...",allowClear:!0,dropdownParent:$("#newChatModal"),ajax:{url:"/search-users",dataType:"json",delay:250,data:function(e){return{q:e.term}},processResults:function(e){return{results:e.results}},cache:!0}})},document.addEventListener("DOMContentLoaded",(function(){var e=document.querySelectorAll('input[name="recipient_type"]');e.length>0&&e.forEach((function(e){e.addEventListener("change",(function(){var e=document.getElementById("user-selection"),t=document.getElementById("segment-selection");"users"===this.value?(e.classList.remove("hidden"),t.classList.add("hidden")):(e.classList.add("hidden"),t.classList.remove("hidden"))}))}))}))})();